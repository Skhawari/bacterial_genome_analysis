import pandas as pd
import glob
import yaml

# Config laden
cfg = yaml.safe_load(open("config/config.yaml"))
# Samples ohne Blacklist
samples = [s for s in pd.read_csv(cfg["samples"], sep="\t").sample_id.tolist()
           if s not in open(cfg["complete_blacklist"]).read().splitlines()]

with pd.ExcelWriter("downstream/summary.xlsx", engine="xlsxwriter") as writer:
    # MLST
    if cfg["pipeline"]["run_mlst"]:
        df = pd.concat([pd.read_csv(f, sep="\t") for f in glob.glob("downstream/mlst/*.txt")],
                       ignore_index=True)
        df.to_excel(writer, sheet_name="MLST", index=False)
    # AMR
    if cfg["pipeline"]["run_amr"]:
        df = pd.concat([pd.read_csv(f, sep="\t") for f in glob.glob("downstream/amr/*.tsv")],
                       ignore_index=True)
        df.to_excel(writer, sheet_name="AMR", index=False)
    # Virulenz
    if cfg["pipeline"]["run_virulence"]:
        df = pd.concat([pd.read_csv(f, sep="\t") for f in glob.glob("downstream/virulence/*.tsv")],
                       ignore_index=True)
        df.to_excel(writer, sheet_name="Virulence", index=False)
    # Plasmid
    if cfg["pipeline"]["run_plasmid"]:
        df = pd.concat([pd.read_csv(f, sep="\t") for f in glob.glob("downstream/plasmid/*.tsv")],
                       ignore_index=True)
        df.to_excel(writer, sheet_name="Plasmid", index=False)